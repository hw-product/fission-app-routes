%h4 Last 7 days: #{@jobs_summary.values.sum} jobs total
%div#nellie_jobs_summary_graph
%h4 Latest
%table.table
  %thead
    %tr
      %th Repository
      %th SHA
      %th Status
  %tbody
  - @recent.each do |job|
    %tr{:colspan => 5}
      %td= link_to(job.payload.fetch(:data, :github, :repository, :name, 'Unknown'), job.payload.fetch(:data, :github, :repository, :url, '#'))
      %td= link_to(job.payload.fetch(:data, :github, :head_commit, :id, 'Unknown'), job.payload.fetch(:data, :github, :head_commit, :url, '#'))
      %td= link_to(job.status, pipeline_job_path(job.message_id))
:javascript
  #{
    graph_generate(
      'nellie_jobs_summary_graph',
      :size => {
        :height => 100
      },
      :line => {
        :label => {
          :show => false
        }
      },
      :data => {
        :type => 'donut',
        :columns => @jobs_summary.map{|k,v|
          [k, v]
        },
        :names => Hash[
          @jobs_summary.keys.map{|k|
            [k.to_s, k.to_s.humanize]
          }
        ],
        :colors => {
          'complete' => 'green',
          'error' => 'red',
          'in_progress' => 'gray'
        }
      }
    )
  }
